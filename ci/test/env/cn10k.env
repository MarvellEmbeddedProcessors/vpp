#!/bin/bash
# Copyright (c) 2024 Marvell.
# SPDX-License-Identifier: Apache-2.0
# https://spdx.org/licenses/Apache-2.0.html

# Directory to keep run specific data on build machine
RUN_DIR=${RUN_DIR:-$BUILD_DIR}

# Test run command
TEST_RUN_CMD=$PROJECT_ROOT/ci/test/board/board_test_run.sh

# Skip syncing build directory to target
SKIP_SYNC=${SKIP_SYNC:-}

# Skip setting up target. Useful when repeatedly running tests.
SKIP_TARGET_SETUP=${SKIP_TARGET_SETUP:-}

# Reboot the target if tests fail
REBOOT_ON_FAIL=${REBOOT_ON_FAIL:-}

# Platform
PLAT=${PLAT:-"cn10k"}

# Target board user@IP. The user is expected to have passwordless ssh.
TARGET_BOARD=${TARGET_BOARD:-root@127.0.0.1}

# Generator board user@IP. The user is expected to have passwordless ssh.
GENERATOR_BOARD=${GENERATOR_BOARD:-}

# Target directory where the VPP build is to be synced
REMOTE_DIR=${REMOTE_DIR:-/tmp/vpp}

# Directory from where the tests will eventually run.
TARGET_RUN_DIR=${TARGET_RUN_DIR:-$REMOTE_DIR}

# Dependency install directory on build machine
DEPS_INSTALL_DIR=${DEPS_INSTALL_DIR:-$BUILD_ROOT/build/deps}

# Sudo command used when running the tests
TARGET_SUDO=sudo

# SSH command used to access board
TARGET_SSH_CMD=${TARGET_SSH_CMD:-"ssh -o LogLevel=ERROR -o ServerAliveInterval=30 -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null"}

# SCP command used to copy files on board
TARGET_SCP_CMD=${TARGET_SCP_CMD:-"scp -o LogLevel=ERROR -o ServerAliveInterval=30 -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null"}

# Extra env to be set when running the tests on the target
EXTRA_TARGET_ENV=${EXTRA_TARGET_ENV:-}

# Default timeout to be applied to the test commands
DEFAULT_CMD_TIMEOUT=${DEFAULT_CMD_TIMEOUT:-30m}

# Test specific command timeouts. To be given as a string of test=timeout entries.
# Eg: CMD_TIMEOUTS="dump_memzone=20m dump_physmem=30m"
CMD_TIMEOUTS=${CMD_TIMEOUTS:-}

# Additional arguments to be passed for specific tests.
CMD_EXTRA_ARGS="
"

# List of tests to be run. If list is empty all tests are run except those in SKIP_TESTS.
RUN_TESTS=${RUN_TESTS:-}

# Flag to enable target setup needed for perf stage.
PERF_STAGE=${PERF_STAGE:-}

# Continue testing regardless of failure
CONTINUE_ON_FAILURE=${CONTINUE_ON_FAILURE:-}

# File to save status into
STATUS_OUTFILE=${STATUS_OUTFILE:-}

FIXME_SKIP_TESTS="
"

DEFAULT_SKIP_TESTS="
	l3fwd_perf
	${FIXME_SKIP_TESTS}
"

# Tests to skipped.
SKIP_TESTS=${SKIP_TESTS:-$DEFAULT_SKIP_TESTS}

# Run tests within this test num range
START_TEST_NUM=${START_TEST_NUM:-1}
END_TEST_NUM=${END_TEST_NUM:-999}

# Functions required to work with test list file.
source $PROJECT_ROOT/ci/test/common/test_list_helper_funcs.sh

# Export the path to this conf so that other scripts can source this conf.
export TEST_ENV_CONF=$PROJECT_ROOT/ci/test/env/cn10k.env
